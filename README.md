# SegMeshGS : 3D Gaussian Splatting-based Object Segmentation and Mesh Extraction Pipeline

[![Unity Version](https://img.shields.io/badge/Unity-2022.3.21f1-blue.svg)](https://unity.com/)
[![Python](https://img.shields.io/badge/Python-3.9%2B-blue.svg)](https://www.python.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**SegMeshGS** is an end-to-end automated pipeline that reconstructs a 3D scene from a video using 3D Gaussian Splatting (3DGS), allows for intuitive object segmentation via a simple click, and extracts the selected object into a high-quality 3D mesh.

The entire workflow is integrated into the Unity editor through the **UnitySegMeshGS** module, providing a seamless and user-friendly experience for content creators, artists, and designers to bring real-world objects into their projects without leaving their primary work environment.

<table>
  <tr>
    <td align="center">
      <img width="250" alt="3DGS Scene" src="https://github.com/user-attachments/assets/eaf09efb-1330-49b7-981f-3b8e083686bc">
      <br>
      <b>3DGS Scene</b>
    </td>
    <td align="center">
      <img width="250" alt="Segmented 3DGS Scene" src="https://github.com/user-attachments/assets/8b2ae381-a28a-4abb-a43d-a023a719cef8">
      <br>
      <b>Segmented 3DGS Scene</b>
    </td>
    <td align="center">
      <img width="250" alt="Mesh" src="https://github.com/user-attachments/assets/6436c05c-057c-4d22-9c5d-f4ebd7b2670d">
      <br>
      <b>Mesh</b>
    </td>
  </tr>
</table>

---

## üöÄ Key Features

* **Fully Automated Pipeline**: Streamlines the entire process from video input to final 3D mesh and texture generation.
* **Intuitive Click-Based Segmentation**: Leverages the power of **SAGA** to precisely segment any object within a 3DGS scene with a single click.
* **High-Quality Mesh Extraction**: Utilizes **SuGaR** to convert segmented Gaussians into a clean, well-structured 3D mesh with detailed textures.
* **Seamless Unity Integration**: The **UnitySegMeshGS** module allows users to execute the entire Python-based pipeline asynchronously from the Unity inspector, preventing editor freeze-ups.
* **Modular Workflow**: Each stage of the pipeline (Vanilla Scene, Segmented Scene, Mesh) produces independent, usable assets, giving creators flexibility.

---

## üõ†Ô∏è Pipeline Workflow

The SegMeshGS pipeline is composed of four main stages, designed to run sequentially with minimal user intervention.  
<img width="370" height="470" alt="Image" src="https://github.com/user-attachments/assets/d955cbbd-23e7-4894-b68d-2b4e9ed95baf" />
<details>
  <summary><b>Click to Expand for Detailed Workflow</b></summary>

### **1. Preprocessing (Frame Extraction & SfM)**
-   **Input**: A single `.mp4` video file.
-   **Tools**: `FFmpeg`, `COLMAP`
-   **Process**:
    1.  **Keyframe Extraction**: `FFmpeg` is used to extract high-quality, non-blurry frames from the source video.
    2.  **Structure-from-Motion (SfM)**: `COLMAP` processes the extracted images to calculate camera poses and generate a sparse point cloud, which serves as the initial geometry for the 3DGS scene.

### **2. Vanilla 3DGS Scene Generation**
-   **Input**: COLMAP output folder.
-   **Process**: The standard 3DGS training algorithm is used to create a photorealistic 3D scene from the COLMAP data. The resulting scene (`.ply` file) has high visual fidelity but lacks any semantic information.

### **3. 3DGS Segmentation (Powered by SAGA)**
-   **Input**: Vanilla 3DGS scene, source images.
-   **Core Technology**: **SAGA (Segment Any 3D Gaussians)**
-   **Process**:
    1.  **Affinity Feature Training**: SAGA attaches a learnable feature vector (Affinity Feature) to each 3D Gaussian. Using 2D masks generated by the Segment Anything Model (SAM), it trains the scene so that Gaussians belonging to the same object have similar features.
    2.  **User-guided Extraction**: The trained scene is opened in the SAGA viewer. The user clicks on any point of the desired object.
    3.  **Export Segmented Object**: The viewer highlights all Gaussians with similar features. This selection is then exported as a new `.ply` file.
    > **‚ö†Ô∏è Important**: The user must name the exported file with a meaningful English word (e.g., `chair.ply`, `sculpture.ply`). This name is used as a text prompt in the next stage.

### **4. 3DGS Meshing (Powered by SuGaR)**
-   **Input**: Segmented object `.ply` file, source images, and the object name from the filename.
-   **Core Technology**: **SuGaR (Surface-Aligned Gaussian Splatting)**
-   **Process**:
    1.  **Input Image Masking**: Using the filename as a text prompt, the **CLIP** model identifies and masks the corresponding object in the 2D source images. This ensures the meshing algorithm focuses only on the target object.
    2.  **Surface Alignment**: SuGaR runs an additional optimization process that regularizes the segmented Gaussians, forcing them to become flat and align tightly with the object's actual surface.
    3.  **Mesh & Texture Generation**: The aligned Gaussians form a dense, oriented point cloud. The **Poisson Surface Reconstruction** algorithm is then applied to this point cloud to generate the final, high-quality 3D mesh (`.obj`) and bake the Gaussian colors into a UV texture map.

</details>

---

## ‚öôÔ∏è Environment Setup

Recommended environment for stable execution:

- **Operating System:** Windows 11  
- **Subsystem:** WSL-Ubuntu 20.04  
- **GPU:** NVIDIA RTX 4070 Ti  
- **CUDA Version:** 11.8  
- **Python Version:** 3.9+

Before running any scripts, make sure to install all dependencies:

---

## üõ†Ô∏è Command-Line Usage

This section describes how to run the pipeline directly from your terminal (e.g., in a WSL2 environment).

### **Step 1: Prerequisite ‚Äì Run COLMAP**

Before using the pipeline, you must first process your source images with **COLMAP** to generate camera poses and a sparse point cloud.  
The pipeline expects a standard COLMAP output directory structure.

---

### **Step 2: Run the Automated SegMeshGS Pipeline**

This is the simplest and recommended way to use the project.  
The `train_SegMeshGS.py` script automates all steps from scene generation to final meshing.

1. **Execute the script**, pointing it to your COLMAP output folder:

   ```bash
   python train_SegMeshGS.py --colmap_folder /path/to/your/colmap_output
   ```

2. **User Interaction Step**  
   The script will pause and automatically open the **SAGA GUI**.  
   In the viewer:
   - Click on the object you want to extract.
   - Export the selection as a `.ply` file.
   - ‚ö†Ô∏è **Important**: Name the file with a meaningful English word (e.g., `chair.ply`, `sculpture.ply`).  
     This name is used as the text prompt for the final meshing stage.

3. **Completion**  
   After you save and close the SAGA GUI, the script will automatically resume and complete the final meshing process.  
   The output `.obj` file and textures will be saved in your project folder.

---

<details>
  <summary><b>Advanced Usage: Running Pipeline Steps Manually</b></summary>

#### **1. Generate Vanilla 3DGS Scene**

Creates the initial photorealistic 3DGS scene.

```bash
python train_scene.py -s /path/to/your/colmap_output
```

---

#### **2. Prepare for SAGA Segmentation**

These scripts prepare the necessary data for SAGA's feature training.

**Extract SAM Masks:**

```bash
python extract_segment_everything_masks.py --image_root /path/to/colmap_output --downsample 1.0
```

**Calculate Scene Scale:**

```bash
python get_scale.py --image_root /path/to/colmap_output --model_path /path/to/colmap_output/SAGA
```

---

#### **3. Train SAGA Affinity Features**

Trains the scene to understand object semantics.

```bash
python train_saga.py -m /path/to/colmap_output/SAGA --iterations 10000
```

---

#### **4. Interactively Segment with SAGA GUI**

Opens the viewer to manually select and export your target object.  
Remember to name the output `.ply` file meaningfully (e.g., `target.ply`).

```bash
python saga_gui.py --model_path /path/to/colmap_output/SAGA
```

---

#### **5. Prepare for SuGaR Meshing (Image Masking)**

Masks the source images to isolate the target object using CLIP.

```bash
python clipsam/faseClipExtract.py --input_folder /path/to/colmap_output --query "target"
```

*(Replace `"target"` with the name you used for your exported `.ply` file.)*

---

#### **6. Run SuGaR for Final Meshing**

Generates the final 3D mesh from the segmented Gaussians.

```bash
python train_sugar.py -s /path/to/colmap_output --segment_targetname "target" --gs_output_dir /path/to/segmented_ply_folder
```

*(Ensure `--segment_targetname` matches your exported object's name and `--gs_output_dir` points to where the segmented `.ply` is located.)*

</details>

---

## üéÆ Unity Integration: UnitySegMeshGS

For users who prefer a GUI-driven workflow, the **UnitySegMeshGS** module provides a bridge to run this entire pipeline from within the Unity Editor.

### **Setup and Testing**

#### **1. Start the Backend Server**

In your WSL2 terminal, navigate to the server directory and run the Flask app.  
This server will listen for commands from Unity.

```bash
# Run the server
python server.py
```

#### **2. Configure Unity Project**

- Open the **UnityProject** folder in Unity Hub (Version **2022.3.21f1** recommended).  
- Using the **Package Manager** (`Window > Package Manager`), click **+ ‚Üí Add package from disk...**  
- Select the `package.json` file located inside the `package/unitySegMeshGS` directory.

#### **3. Run Pipeline from Unity**

With the server running, you can now use the **custom inspector buttons** provided by the UnitySegMeshGS module to execute the pipeline steps easily.

---

## üìö References & Credits

This project stands on the shoulders of giants.  
We are immensely grateful to the researchers and developers behind these incredible open-source projects:

- **3D Gaussian Splatting**: [3D Gaussian Splatting for Real-Time Radiance Field Rendering](https://repo-sam.inria.fr/fungraph/3d-gaussian-splatting/)
- **SAGA**: [Segment Any 3D Gaussians](https://github.com/yzslab/segment-any-3d-gaussians)
- **SuGaR**: [Surface-Aligned Gaussian Splatting for Efficient 3D Mesh Reconstruction](https://github.com/hugohenrycs/SuGaR)
- **Unity Viewer**: [UnityGaussianSplatting by @aras-p](https://github.com/aras-p/UnityGaussianSplatting)
